var itemInCart,rootLinkTikTokPixel="https://apps3.omegatheme.com/shopify/tiktok-multi-pixels-clone/server.php",rootAppPublicTikTokPixel="https://apps3.omegatheme.com/shopify/tiktok-multi-pixels/public",shop=Shopify.shop,pageURL=null,CONTENT_TYPE_IS_PRODUCT_GROUP=0,CONTENT_TYPE_IS_PRODUCT=1,pageURL=window.location.href,EVENT_NAME_TOOL={browse:"Page View",viewContent:"View Content",addToCart:"Add to Cart",startCheckout:"Initiate Checkout",purchase:"Complete payment"},user_agent=getUserAgent(),pageReferrer="",currency=Shopify.currency.active,cart_url="//"+window.location.hostname+"/cart.json",buttonsATCOmegaTikTok=(localStorage.setItem("OT_TT_SHOP",shop),[".gt_button-atc","#teeAtcButton","#new-form-atc",".ProductForm__AddToCart",".single_add_to_cart_button","#AddToCartForm button",".product__form button.add-to-cart","#AddToCart-product-template",".product-form__cart-submit","[name^='add']"].flatMap(t=>Array.from(document.querySelectorAll(t)))),otElementButtonAddToCart=buttonsATCOmegaTikTok.filter(t=>{var e="Choose options"===t.textContent.trim(),t=Array.from(t.querySelectorAll("*")).some(t=>"Choose options"===t.textContent.trim());return!(e||t)}),otElementButtonCheckout='form[action^="/checkout"] :submit[name^="checkout"], form[action^="/checkout"] .checkout-button, .checkout_btn, .btn-checkout, .OTCheckout, [name^="checkout"], form[action^="/cart"] :submit[name^="checkout"], form[action^="/cart"] .checkout-button, #cart .action_button.right .gt_checkout_button_main, .upcart-checkout-button-container, .upcart-checkout-button-container a, a[href="/checkout"], #upCart, #_rsi-buy-now-button, #_rsi-buy-now-button span',otElementButtonBuyItNow=".shopify-payment-button__button, .shopify-payment-button__button--unbranded, #_rsi-buy-now-button, #_rsi-buy-now-button span",ip=null,ipSource=null,ot_ttclid=null;let ttpCookie=null;var tik_tok_utm_parameter=otTikTokPixelDetectCampaign(),checkStoreNewOmegaTikTok=null,dayCheckNewStoreVersionAtcWebPixel="2024-11-06";async function otTikTokPixelInit(t){e=Shopify.Checkout&&-1!==Shopify.Checkout.page.indexOf("thank_you")?await otTikTokPixelCheckExpireApp(t,rootLinkTikTokPixel,shop):tikTokPixelCheckExpireApp;var e,o=tikTokPixelCheckExpireApp?.last_install_date?compareDates(tikTokPixelCheckExpireApp.last_install_date,dayCheckNewStoreVersionAtcWebPixel):"old",o=(checkStoreNewOmegaTikTok!==o&&("new"==o&&t(otElementButtonAddToCart).off("click"),checkStoreNewOmegaTikTok=o)&&await updateAddToCartLogicTikTok(),localStorage.setItem("OT_TT_CHECK_EXPIRED",JSON.stringify(e)),void 0!==e.settings?e.settings:null),r=(localStorage.setItem("OT_TT_SETTINGS",JSON.stringify(o)),ot_ttclid=otAddAttributeIDAds(t,o),generateExternalIDTikTokPixel(36));otAddExternalIDToOrder(t,r),e.check_expire||(null!==o?1!=o.enable:1!=e.enable_app)||((async()=>{var t=await getIP(),t=(ipSource=t).match(/(?:ip=)?([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3})/);ip=t&&1<t.length?(t[0].startsWith("ip="),t[1]):"IP undefine"})().then(()=>{console.log("IP:",ip)}),ttpCookie=getCookieValue("_ttp"),otMultiTikTokPixel(t,o,e)),addDataLocalStorageTriggerTikTok()}async function otMultiTikTokPixel(l,t,e){var u=(null!==t?t:e).content_type_event,p=(null!==t?t:e).enable_deduplication;if("undefined"!=typeof arrayTikTokPixelTrackNew&&"undefined"!=typeof arrayTikTokPixelCapiTrackNew){arrayTikTokPixelTrackNew.forEach(async function(t,e){ttq.checkOmega(""+t,"PageView")});let c=u==CONTENT_TYPE_IS_PRODUCT?"product":"product_group";if(0<arrayTikTokPixelCapiTrackNew.length){let o=getEventID(generateExternalIDTikTokPixel(36));1==p&&arrayTikTokPixelCapiTrackNew.forEach(async function(t,e){ttq.checkOmega(""+t,"PageView",o)})}if(-1<pageURL.indexOf("/products/")){var n=await otGetInfoProductByLink(-1<pageURL.indexOf("?")?pageURL.split("?")[0]+".json":pageURL+".json",l);-1<n.title.indexOf("'")&&(n.title=n.title.replace(/'/g,""));let i=(void 0!==n.id?n:meta.product).id;e=ot_getUrlParam("variant");if(u==CONTENT_TYPE_IS_PRODUCT&&(i=null!==e?e:meta.product.variants[0].id),arrayTikTokPixelTrackNew.forEach(async function(t,e){ttq.checkOmega(""+t,"ViewContent",{content_id:""+i,content_type:c,value:otConvertPrice(n.variants[0].price),content_name:""+n.title,currency:""+currency})}),0<arrayTikTokPixelCapiTrackNew.length){let t=generateExternalIDTikTokPixel(36),o=getEventID(t),e=getCurrentTimeUTCInSeconds(),r=document.referrer;(async()=>{trackEventsAPITikTok(l,{utm:tik_tok_utm_parameter?.ttclid?tik_tok_utm_parameter:null,referrer:r,action:"ViewContent",event:"ViewContent",eventShowTool:EVENT_NAME_TOOL.viewContent,event_id:o,url:pageURL,pixel_ids:arrayTikTokPixelCapiTrackNew,shop:Shopify.shop,ip:null!==ip?ip:"",user_agent:user_agent,external_id:t,value:otConvertPrice(n.variants[0].price),content_name:""+n.title,currency:""+currency,content_id:""+i,content_type:""+c,ttclid:ot_ttclid,event_time:e,ttp:ttpCookie,ip_source:ipSource??null,products:meta?.product?[meta?.product]:null})})(),1==p&&arrayTikTokPixelCapiTrackNew.forEach(async function(t,e){ttq.checkOmega(""+t,"ViewContent",{content_id:""+i,content_type:c,value:otConvertPrice(n.variants[0].price),content_name:""+n.title,currency:""+currency},o)})}}"old"==checkStoreNewOmegaTikTok&&(-1<pageURL.indexOf("/cart")&&getItemOnCartPage(l,function(i){var t=(itemInCart=i).items;let n=t[t.length-1];var t=localStorage.getItem("OTPX"),e=localStorage.getItem("OTPXADDED");if((t!=i.item_count||null==t)&&1!=e){localStorage.setItem("OTPXADDED",0),localStorage.setItem("OTPX",i.item_count);let r=n.product_id;if(u==CONTENT_TYPE_IS_PRODUCT&&(r=n.variant_id),arrayTikTokPixelTrackNew.forEach(async function(t,e){ttq.checkOmega(""+t,"AddToCart",{content_id:""+r,content_type:c,value:otConvertPrice(parseInt(i.total_price)/100),content_name:""+n.product_title,currency:""+currency})}),0<arrayTikTokPixelCapiTrackNew.length){t=generateExternalIDTikTokPixel(36);let o=getEventID(t);var e=getCurrentTimeUTCInSeconds(),a=document.referrer;trackEventsAPITikTok(l,{utm:tik_tok_utm_parameter?.ttclid?tik_tok_utm_parameter:null,referrer:a,action:"AddToCart",event:"AddToCart",eventShowTool:EVENT_NAME_TOOL.addToCart,event_id:o,url:pageURL,pixel_ids:arrayTikTokPixelCapiTrackNew,shop:Shopify.shop,ip:null!==ip?ip:"",user_agent:user_agent,external_id:t,content_id:""+r,content_type:c,value:otConvertPrice(parseInt(i.total_price)/100),currency:""+currency,ttclid:ot_ttclid,event_time:e,ttp:ttpCookie,ip_source:ipSource,products:n?[n]:null}),1==p&&arrayTikTokPixelCapiTrackNew.forEach(async function(t,e){ttq.checkOmega(""+t,"AddToCart",{content_id:""+r,content_type:c,value:otConvertPrice(parseInt(i.total_price)/100),content_name:""+n.product_title,currency:""+currency},o)})}}}),l(otElementButtonAddToCart).click(function(t){setTimeout(function(){l.ajax({type:"GET",url:"/cart.js",dataType:"json"}).done(a=>{if(localStorage.setItem("OTPXADDED",1),console.log("vào code base cũ"),0<a.items.length){let i=a.items[0],n=i.product_id;if(u==CONTENT_TYPE_IS_PRODUCT&&(n=i.variant_id),arrayTikTokPixelTrackNew.forEach(async function(t,e){ttq.checkOmega(""+t,"AddToCart",{content_id:""+n,content_type:c,value:otConvertPrice(parseInt(a.total_price)/100),content_name:""+i.product_title,currency:""+currency})}),0<arrayTikTokPixelCapiTrackNew.length){let e=generateExternalIDTikTokPixel(36),o=getEventID(e),r=getCurrentTimeUTCInSeconds();async function t(){var t=document.referrer;trackEventsAPITikTok(l,{utm:tik_tok_utm_parameter?.ttclid?tik_tok_utm_parameter:null,referrer:t,action:"AddToCart",event:"AddToCart",eventShowTool:EVENT_NAME_TOOL.addToCart,event_id:o,url:pageURL,pixel_ids:arrayTikTokPixelCapiTrackNew,shop:Shopify.shop,ip:null!==ip?ip:"",user_agent:user_agent,external_id:e,content_id:""+n,content_type:c,value:otConvertPrice(parseInt(a.total_price)/100),currency:""+currency,ttclid:ot_ttclid,event_time:r,ttp:ttpCookie,ip_source:ipSource,products:i?[i]:null})}t(),1==p&&arrayTikTokPixelCapiTrackNew.forEach(async function(t,e){ttq.checkOmega(""+t,"AddToCart",{content_id:""+n,content_type:c,value:otConvertPrice(parseInt(a.total_price)/100),content_name:""+i.product_title,currency:""+currency},o)})}}else if(void 0!==meta.product){let i=meta.product.id;var e=ot_getUrlParam("variant");if(u==CONTENT_TYPE_IS_PRODUCT&&(i=null!==e?e:meta.product.variants[0].id),arrayTikTokPixelTrackNew.forEach(async function(t,e){ttq.checkOmega(""+t,"AddToCart",{content_id:""+i,content_type:c,value:otConvertPrice(parseInt(meta.product.variants[0].price)/100),content_name:""+meta.product.variants[0].name,currency:""+currency})}),0<arrayTikTokPixelCapiTrackNew.length){let e=generateExternalIDTikTokPixel(36),o=getEventID(e),r=getCurrentTimeUTCInSeconds();async function t(){var t=document.referrer;trackEventsAPITikTok(l,{utm:tik_tok_utm_parameter?.ttclid?tik_tok_utm_parameter:null,referrer:t,action:"AddToCart",event:"AddToCart",eventShowTool:EVENT_NAME_TOOL.addToCart,event_id:o,pixel_ids:arrayTikTokPixelCapiTrackNew,shop:Shopify.shop,ip:null!==ip?ip:"",user_agent:user_agent,external_id:e,content_id:""+i,content_type:c,value:otConvertPrice(parseInt(meta.product.variants[0].price)/100),currency:""+currency,ttclid:ot_ttclid,event_time:r,ttp:ttpCookie,url:pageURL,ip_source:ipSource,products:meta?.product?[meta?.product]:null})}t(),1==p&&arrayTikTokPixelCapiTrackNew.forEach(async function(t,e){ttq.checkOmega(""+t,"AddToCart",{content_id:""+i,content_type:c,value:otConvertPrice(parseInt(meta.product.variants[0].price)/100),content_name:""+meta.product.variants[0].name,currency:""+currency},o)})}}else setTimeout(()=>{omegaTiktokCallbackAtc()},1500);e=generateExternalIDTikTokPixel(36);a.attributes.external_id&&a.attributes.external_id==e||otAddExternalIDToOrder(l,e)})},500)})),l("body").on("click",otElementButtonCheckout,function(t){if(void 0!==itemInCart&&void 0!==itemInCart.items){var n=itemInCart;if(0<n.items.length){let i=[];if(l.each(n.items,function(t,e){let o=e.product_id;u==CONTENT_TYPE_IS_PRODUCT&&(o=e.variant_id),i.push({content_id:""+o,content_type:c,content_name:e.product_title,quantity:e.quantity,price:otConvertPrice(e.final_price)})}),arrayTikTokPixelTrackNew.forEach(async function(t,e){ttq.checkOmega(""+t,"StartCheckout",{contents:i,currency:""+currency,value:otConvertPrice(n.total_price/100)})}),0<arrayTikTokPixelCapiTrackNew.length){let e=generateExternalIDTikTokPixel(36),o=getEventID(e),r=getCurrentTimeUTCInSeconds();(async()=>{var t=document.referrer;trackEventsAPITikTok(l,{utm:tik_tok_utm_parameter?.ttclid?tik_tok_utm_parameter:null,referrer:t,action:"StartCheckout",event:"StartCheckout",eventShowTool:EVENT_NAME_TOOL.startCheckout,event_id:o,pixel_ids:arrayTikTokPixelCapiTrackNew,shop:Shopify.shop,ip:null!==ip?ip:"",user_agent:user_agent,external_id:e,contents:i,currency:""+currency,value:otConvertPrice(n.total_price/100),ttclid:ot_ttclid,event_time:r,ttp:ttpCookie,url:pageURL,ip_source:ipSource,products:itemInCart?.items??null})})(),1==p&&arrayTikTokPixelCapiTrackNew.forEach(async function(t,e){ttq.checkOmega(""+t,"StartCheckout",{contents:i,currency:""+currency,value:otConvertPrice(n.total_price/100)},o)})}}}else l.ajax({type:"GET",url:"/cart.js",dataType:"json"}).done(n=>{if(0<n.items.length){let i=[];if(l.each(n.items,function(t,e){let o=e.product_id;u==CONTENT_TYPE_IS_PRODUCT&&(o=e.variant_id),i.push({content_id:""+o,content_type:c,content_name:e.product_title,quantity:e.quantity,price:otConvertPrice(e.final_price)})}),arrayTikTokPixelTrackNew.forEach(async function(t,e){ttq.checkOmega(""+t,"StartCheckout",{contents:i,currency:""+currency,value:otConvertPrice(n.total_price/100)})}),0<arrayTikTokPixelCapiTrackNew.length){let e=generateExternalIDTikTokPixel(36),o=getEventID(e),r=getCurrentTimeUTCInSeconds();(async()=>{var t=document.referrer;trackEventsAPITikTok(l,{utm:tik_tok_utm_parameter?.ttclid?tik_tok_utm_parameter:null,referrer:t,action:"StartCheckout",event:"StartCheckout",eventShowTool:EVENT_NAME_TOOL.startCheckout,event_id:o,pixel_ids:arrayTikTokPixelCapiTrackNew,shop:Shopify.shop,ip:null!==ip?ip:"",user_agent:user_agent,external_id:e,contents:i,currency:""+currency,value:otConvertPrice(n.total_price/100),ttclid:ot_ttclid,event_time:r,ttp:ttpCookie,url:pageURL,ip_source:ipSource,products:n?.items??null})})(),1==p&&arrayTikTokPixelCapiTrackNew.forEach(async function(t,e){ttq.checkOmega(""+t,"StartCheckout",{contents:i,currency:""+currency,value:otConvertPrice(n.total_price/100)},o)})}}var t=generateExternalIDTikTokPixel(36);n.attributes.external_id&&n.attributes.external_id==t||otAddExternalIDToOrder(l,t)}).fail(function(t,e){})}),document.addEventListener("click",function(t){if(t.target.matches(otElementButtonBuyItNow)){let o=[];var e,r,t=meta?.product?.variants[0]?.id+"";o.push({content_id:t,content_type:"product_group",content_name:meta?.product?.variants[0]?.name||"",quantity:1,price:meta?.product?.variants[0]?.price/100||0}),arrayTikTokPixelTrackNew.forEach(async function(t,e){ttq.checkOmega(""+t,"StartCheckout",{contents:o,currency:""+Shopify?.currency?.active,value:meta?.product?.variants[0]?.price/100||0})}),0<arrayTikTokPixelCapiTrackNew.length&&(e=getEventID(t=generateExternalIDTikTokPixel(36)),r=document.referrer,trackEventsAPITikTok(l,{utm:tik_tok_utm_parameter?.ttclid?tik_tok_utm_parameter:null,referrer:r,action:"StartCheckout",event:"StartCheckout",eventShowTool:EVENT_NAME_TOOL.startCheckout,event_id:e,url:pageURL,pixel_ids:arrayTikTokPixelCapiTrackNew,shop:Shopify.shop,ip:null!==ip?ip:"",user_agent:user_agent,contents:o,currency:""+currency,value:meta?.product?.variants[0]?.price/100||0,ttclid:otAddAttributeIDAds(),external_id:t,ip_source:ipSource,products:meta?.product??null}),1==tikTokPixelCheckExpireApp.enable_deduplication)&&arrayTikTokPixelCapiTrackNew.forEach(async function(t,e){ttq.checkOmega(""+t,"StartCheckout",{contents:o,currency:""+Shopify?.currency?.active,value:meta?.product?.variants[0]?.price/100||0})})}})}if(Shopify.Checkout&&-1!==Shopify.Checkout.page.indexOf("thank_you")&&void 0!==t.updated_web_pixel_at&&null==t.updated_web_pixel_at){let n=[];var a=[];Shopify.checkout.line_items.forEach(function(t,e){var o;o=""!=t.variant_title?t.title+" - "+t.variant_title:t.title,a.push(t.product_id);let r="product_group",i=t.product_id;u==CONTENT_TYPE_IS_PRODUCT&&(i=t.variant_id,r="product"),n.push({content_id:""+i,content_type:r,content_name:o,quantity:t.quantity,price:otConvertPrice(t.price)})}),addEventPurchaseInThankYouPageTikTok(l,n,a,p,t)}}function getItemOnCartPage(t,e){t.ajax({type:"GET",url:"/cart.js",dataType:"json"}).done(t=>{"function"==typeof e&&e(t)})}function otTikTokPixelCheckExpireApp(t,o,r){return new Promise(e=>{t.ajax({type:"GET",data:{shop:r},url:o+"/api/external/check-expire",dataType:"json"}).done(t=>{e(t.data)})})}function compareDates(t,e){return t?new Date(t)<new Date(e)?"old":"new":null}function omegaTiktokCallbackAtc(){$.ajax({type:"GET",url:"/cart.js",dataType:"json"}).done(async a=>{localStorage.setItem("OTPXADDED",1);var t=void 0!==tikTokPixelCheckExpireApp.settings?tikTokPixelCheckExpireApp.settings:null,e=(null!==t?t:tikTokPixelCheckExpireApp).content_type_event,t=(null!==t?t:checkTiktokPixelExpire).enable_deduplication;let c="product_group";if(0<a.items.length){let i=a.items[0],n=i.product_id;if(e==CONTENT_TYPE_IS_PRODUCT&&(n=i.variant_id),arrayTikTokPixelTrackNew.forEach(async function(t,e){ttq.checkOmega(""+t,"AddToCart",{content_id:""+n,content_type:c,value:otConvertPrice(parseInt(a.total_price)/100),content_name:""+i.product_title,currency:""+currency})}),0<arrayTikTokPixelCapiTrackNew.length){let e=generateExternalIDTikTokPixel(36),o=getEventID(e),r=getCurrentTimeUTCInSeconds();(async()=>{var t=document.referrer;trackEventsAPITikTok($,{utm:tik_tok_utm_parameter?.ttclid?tik_tok_utm_parameter:null,referrer:t,action:"AddToCart",event:"AddToCart",eventShowTool:EVENT_NAME_TOOL.addToCart,event_id:o,pixel_ids:arrayTikTokPixelCapiTrackNew,shop:Shopify.shop,ip:null!==ip?ip:"",user_agent:user_agent,external_id:e,content_id:""+n,content_type:c,value:otConvertPrice(parseInt(a.total_price)/100),currency:""+currency,ttclid:ot_ttclid,event_time:r,ttp:ttpCookie,url:pageURL,ip_source:ipSource,products:i?[i]:null})})(),1==t&&arrayTikTokPixelCapiTrackNew.forEach(async function(t,e){ttq.checkOmega(""+t,"AddToCart",{content_id:""+n,content_type:c,value:otConvertPrice(parseInt(a.total_price)/100),content_name:""+i.product_title,currency:""+currency},o)})}}e=generateExternalIDTikTokPixel(36);a.attributes.external_id&&a.attributes.external_id==e||otAddExternalIDToOrder($,e)})}async function addEventPurchaseInThankYouPageTikTok(i,n,t,a,e){t=await getAllTikTokPixelInThankYouPage(t);if(void 0!==t.pixels&&void 0!==t.pixelsCapi){window.arrayTikTokPixelCapiTrackNew=t.pixelsCapi,window.arrayTikTokPixel=t.pixelCapi_information,otIncludeTrackTool();var c,o=t.pixels,l=t.pixelsCapi;if(c=e.include_shippping_cost?Shopify.checkout.total_price:Shopify.checkout.subtotal_price,0<o.length&&o.forEach(async function(t,e){ttq.checkOmega(""+t,"Purchase",{contents:n,currency:""+currency,value:otConvertPrice(c)})}),0<l.length){let e=generateExternalIDTikTokPixel(36),o=Shopify.checkout.order_id,r=document.referrer;getInformationCustomerHash(Shopify,e).then(t=>{try{localStorage.setItem("user_information",JSON.stringify(t))}catch{}trackEventsAPITikTok(i,{utm:tik_tok_utm_parameter?.ttclid?tik_tok_utm_parameter:null,referrer:r,action:"Purchase",event:"Purchase",eventShowTool:EVENT_NAME_TOOL.purchase,event_id:o,url:pageURL,pixel_ids:l,shop:Shopify.shop,ip:null!==ip?ip:"",user_agent:user_agent,external_id:sha256(e),contents:n,currency:""+currency,value:otConvertPrice(c),user:t,order_id:Shopify.checkout.order_id,ttclid:ot_ttclid,ip_source:ipSource}),1==a&&l.forEach(async function(t,e){ttq.checkOmega(""+t,"Purchase",{contents:n,currency:""+currency,value:otConvertPrice(c)},o.toString())})})}}}function getAllTikTokPixelInThankYouPage(t){return new Promise(e=>{$.ajax({type:"GET",data:{product_ids:t,shop:shop},url:rootLinkTikTokPixel+"/api/external/pixels/purchase",dataType:"json"}).done(t=>{"string"==typeof t&&(t=JSON.parse(t)),e(t.data)})})}function otGetInfoProductByLink(t,o){return new Promise(e=>{o.ajax({url:t,dataType:"jsonp",header:{"Access-Control-Allow-Origin":"*"},success:function(t){"string"==typeof t&&(t=JSON.parse(t)),e(t.product)}})})}async function trackEventsAPITikTok(e,o){"Purchase"!==o.action&&"sapphire-online.myshopify.com"!==o.shop?e.ajax({url:rootLinkTikTokPixel+"/api/external/events-api",type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",keepalive:!0,data:JSON.stringify(o),keepalive:!0}).done(t=>{conditionShowTestTool(e,o,t)}).fail(t=>{console.log(t)}):"viralclothingworld.myshopify.com"==Shopify.shop?e.ajax({url:rootLinkTikTokPixel+"/api/external/events-api",type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify(o),keepalive:!0}).done(t=>{conditionShowTestTool(e,o,t)}).fail(t=>{console.log(t)}):conditionShowTestTool(e,o,{code:200})}function conditionShowTestTool(i,n,a){"show"!=sessionStorage.getItem("OT_TIKTOK_TRACK_TOOL_EVENT_API")&&"1"!=ot_getUrlParam("otEnableTrackTool")||n.pixel_ids.forEach(t=>{var e=(new Date).getTime(),e=n.event+"-"+t+"-"+e;let o={domCardPixelTrack:"#ot-card-pixel-"+t,domTitlePixelTrack:"#ot-title-pixel-"+t,domAttributePixelTrack:"ot-attribute-event-"+e,domInformationEventStatus:"ot-information-event-status-"+e,domSvgLeft:"ot-svg-left"+e,domSvgDown:"ot-svg-down-"+e},r=setInterval(function(){i(o.domCardPixelTrack).length&&(otAppendEventInformation(i,o,a,n),clearInterval(r))},100)})}async function getIP(){try{var t=await fetch("https://www.cloudflare.com/cdn-cgi/trace");if(t.ok)return await t.text();throw new Error("Network response was not ok")}catch(t){console.error("Lỗi khi lấy địa chỉ IP:",t)}}function generateExternalIDTikTokPixel(t){for(var e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890".split(""),o=[],r=0;r<t;r++){var i=(Math.random()*(e.length-1)).toFixed(0);o[r]=e[i]}var n=localStorage.getItem("external_id_tik_tok_pixel");return n||localStorage.setItem("external_id_tik_tok_pixel",o.join("")),n}async function getInformationCustomerHash(t,e){let o=null;return{external_id:await sha256(e),email:null==t.checkout.email?"":await sha256(t.checkout.email),phone_number:o=null==t.checkout.phone?null!=t.checkout.billing_address.phone?await sha256(t.checkout.billing_address.phone):null!=t.checkout.shipping_address.phone?await sha256(t.checkout.shipping_address.phone):await sha256(""):await sha256(t.checkout.phone)}}function getEventID(t){return t+randomStringNumber()}function randomStringNumber(){let e="";for(let t=0;t<10;t++)e+="0123456789"[Math.floor(9*Math.random())];return e}async function sha256(t){t=new TextEncoder("utf-8").encode(String(t).toLowerCase().trim()),t=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(t)).map(t=>("00"+t.toString(16)).slice(-2)).join("")}function getUserAgent(){return window.navigator.userAgent}function ot_getUrlParam(t){t=window.location.search.match("[?&]"+t+"(?:&|$|=([^&]*))");return t?t[1]||"":null}function otIncludeTrackTool(){var t=(new Date).getTime();"show"!=sessionStorage.getItem("OT_TIKTOK_TRACK_TOOL_EVENT_API")&&"1"!=ot_getUrlParam("otEnableTrackTool")||(sessionStorage.setItem("OT_TIKTOK_TRACK_TOOL_EVENT_API","show"),$.getScript(rootAppPublicTikTokPixel+"/js/tiktok-track-tool.js?v="+t))}function otAddAttributeIDAds(t,e){var e=null!==e?e?.is_accept_permission_write_orders:0,o=otGetCookie("ttclid"),r=ot_getUrlParam("ttclid"),i=localStorage.getItem("ttclid");return isJsonString(i)&&null!=i&&"null"!=i&&8<=otGetDayOfTime(JSON.parse(i).time,(new Date).getTime())&&window.localStorage.removeItem("ttclid"),null!=r?(otSetCookie("ttclid",r,6),window.localStorage.setItem("ttclid",JSON.stringify({time:(new Date).getTime(),ttclid:r})),otAddAttributeClickIdToOrder(t,r,e),r):""!=o?(otAddAttributeClickIdToOrder(t,o,e),o):null!=i&&"null"!=i&&isJsonString(i)?(otAddAttributeClickIdToOrder(t,r=JSON.parse(i).ttclid,e),r):null}function otAppendEventInformation(t,e,o,r){t(e.domCardPixelTrack).append(`<div>
        <div class = "ot-information-event-status" id = "${e.domInformationEventStatus}">
          <div class = "ot-box-title-event-status">
            ${200==o.code?window.OT_SVG_TIKTOK.ot_svg_tick:window.OT_SVG_TIKTOK.ot_svg_error}
            <span class = "ot-title-event">${r.eventShowTool}</span>
          </div>
          <div style="padding: 13px 10px 0px 10px; display: block" id ="${e.domSvgLeft}">
            ${window.OT_SVG_TIKTOK.ot_svg_arrow_left}
          </div>
          <div style="padding: 13px 10px 0px 10px; display: none" id ="${e.domSvgDown}">
            ${window.OT_SVG_TIKTOK.ot_svg_arrow_down}
          </div>
          </div>
            <div class = "ot-attribute-event" id = "${e.domAttributePixelTrack}">
            ${200!==o.code&&o.message?`
            <span style = "color: #8B8B8B;
            margin: 5px 0;">ERROR</span>
            <span><b>${o.message}</b></span>
            `:` ${r.content_type&&"Browse"!==r.event?`<span><b>content_type:</b> ${r.content_type}</span>`:""}
                ${r.content_id?`<span><b>content_id:</b> ${r.content_id}</span>`:""}
                ${r.value?`<span><b>value:</b>${r.value}</span>`:""}
                ${r.content_name?`<span><b>content_name:</b> ${r.content_type}</span>`:""}
                ${r.currency?`<span><b>currency: </b>${r.currency}</span>`:""}
                ${r.contents?`<span><b>contents:</b>${JSON.stringify(r.contents)}</span>`:""}
                  <span><b>Page URL:</b> ${r.url}</span>`}

          </div>
    </div>`),t(e.domTitlePixelTrack).css("border-bottom","1px solid #e4e4e4"),t("#"+e.domInformationEventStatus).click(function(){"none"==t("#"+e.domAttributePixelTrack).css("display")?(t("#"+e.domAttributePixelTrack).css("display","flex"),t("#"+e.domSvgLeft).css("display","none"),t("#"+e.domSvgDown).css("display","block")):(t("#"+e.domAttributePixelTrack).css("display","none"),t("#"+e.domSvgLeft).css("display","block"),t("#"+e.domSvgDown).css("display","none"))})}function sendBrowserUrlLog(t,o,r){return new Promise(e=>{t.ajax({type:"GET",data:{shop:r,url:window.location.href},url:o+"/api/external/browser-url-log",dataType:"json"}).done(t=>{e(t.data)})})}function otSetCookie(t,e,o){var r=new Date,o=(r.setTime(r.getTime()+24*o*60*60*1e3),"expires="+r.toGMTString());document.cookie=t+"="+e+";"+o+";path=/"}function otGetCookie(t){var o=t+"=",r=decodeURIComponent(document.cookie).split(";");for(let e=0;e<r.length;e++){let t=r[e];for(;" "==t.charAt(0);)t=t.substring(1);if(0==t.indexOf(o))return t.substring(o.length,t.length)}return""}function otSaveUrlToMongo(r,i,n){getIP().then(t=>{let o=t.split("ip=")[1].split("\n")[0];return new Promise(e=>{r.ajax({type:"POST",data:{url:i,shop:n,ip:o,user_agent:window.navigator.userAgent},url:"https://apps2.omegatheme.com/shopify/facebook-pixel-event-log/api/url-logs",dataType:"json"}).done(t=>{"string"==typeof t&&(t=JSON.parse(t)),e(t)})})})}function otConvertPrice(t){return Number(t)%1!=0?parseFloat(t).toFixed(2):t}function otGetDayOfTime(t,e){return Math.ceil((e-t)/864e5)}function isJsonString(t){try{JSON.parse(t)}catch(t){return!1}return!0}function otAddAttributeClickIdToOrder(t,e,o){null!=e&&""!==e&&1==o&&(o={ot_ttclid:e},tik_tok_utm_parameter?.ttclid&&(o.utm_tt_pixel_omega=JSON.stringify(tik_tok_utm_parameter)),t.ajax({type:"POST",url:"/cart/update.js",dataType:"json",data:{attributes:o}}).done(t=>{console.log("Add ttclid: "+e)}))}function otAddExternalIDToOrder(t,e){var o=localStorage.getItem("external_id_tik_tok_pixel");null!=e&&""!==e&&o!=e&&(o={ot_external_id:e},tik_tok_utm_parameter?.ttclid&&(o.utm_tt_pixel_omega=JSON.stringify(tik_tok_utm_parameter)),t.ajax({type:"POST",url:"/cart/update.js",dataType:"json",data:{attributes:o}}))}function getCurrentTimeUTCInSeconds(){try{var t=new Date,e=Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds());return Math.floor(e/1e3)}catch(t){return console.error("Error getting current time in UTC seconds:",t),null}}function getCookieValue(t){try{var e;for(e of document.cookie.split("; ")){var[o,r]=e.split("=");if(o===t)return decodeURIComponent(r)}return null}catch(t){return console.error("Error retrieving cookie:",t),null}}function getFirstValueAfterSlash(){var t=window?.location?.pathname;try{return t.split("/")[1]||"home"}catch(t){return console.error("Error:",t),null}}async function checkAddToCartEventTikTok(){console.log("ATC click");var t=void 0!==tikTokPixelCheckExpireApp.settings?tikTokPixelCheckExpireApp.settings:null,o=(null!==t?t:tikTokPixelCheckExpireApp).content_type_event,l=(null!==t?t:checkTiktokPixelExpire).enable_deduplication;let u="product_group";-1<pageURL.indexOf("/cart")&&getItemOnCartPage($,function(i){var t=(itemInCart=i).items;let n=t[t.length-1];var t=localStorage.getItem("OTPX"),e=localStorage.getItem("OTPXADDED");if((t!=i.item_count||null==t)&&1!=e){localStorage.setItem("OTPXADDED",0),localStorage.setItem("OTPX",i.item_count);let r=n.product_id;if(o==CONTENT_TYPE_IS_PRODUCT&&(r=n.variant_id,u="product"),(arrayTikTokPixelTrackNew?.length||arrayTikTokPixelCapiTrackNew?.length)&&(countEventAtc=1),arrayTikTokPixelTrackNew.forEach(async function(t,e){ttq.checkOmega(""+t,"AddToCart",{content_id:""+r,content_type:u,value:otConvertPrice(parseInt(i.total_price)/100),content_name:""+n.product_title,currency:""+currency})}),0<arrayTikTokPixelCapiTrackNew.length){t=generateExternalIDTikTokPixel(36);let o=getEventID(t);var e=getCurrentTimeUTCInSeconds(),a=document.referrer;trackEventsAPITikTok($,{utm:tik_tok_utm_parameter?.ttclid?tik_tok_utm_parameter:null,referrer:a,action:"AddToCart",event:"AddToCart",eventShowTool:EVENT_NAME_TOOL.addToCart,event_id:o,url:pageURL,pixel_ids:arrayTikTokPixelCapiTrackNew,shop:Shopify.shop,ip:null!==ip?ip:"",user_agent:user_agent,external_id:t,content_id:""+r,content_type:u,value:otConvertPrice(parseInt(i.total_price)/100),currency:""+currency,ttclid:ot_ttclid,event_time:e,ttp:ttpCookie,ip_source:ipSource,products:n?[n]:null}),1==l&&arrayTikTokPixelCapiTrackNew.forEach(async function(t,e){ttq.checkOmega(""+t,"AddToCart",{content_id:""+r,content_type:u,value:otConvertPrice(parseInt(i.total_price)/100),content_name:""+n.product_title,currency:""+currency},o)})}}}),$(otElementButtonAddToCart).click(function(t){setTimeout(function(){$.ajax({type:"GET",url:"/cart.js",dataType:"json"}).done(a=>{if(console.log("ATC click click"),localStorage.setItem("OTPXADDED",1),0<a.items.length){let i=a.items[0],n=i.product_id;if(o==CONTENT_TYPE_IS_PRODUCT&&(n=i.variant_id,u="product"),(arrayTikTokPixelTrackNew?.length||arrayTikTokPixelCapiTrackNew?.length)&&(countEventAtc=1),arrayTikTokPixelTrackNew.forEach(async function(t,e){ttq.checkOmega(""+t,"AddToCart",{content_id:""+n,content_type:u,value:otConvertPrice(parseInt(a.total_price)/100),content_name:""+i.product_title,currency:""+currency})}),0<arrayTikTokPixelCapiTrackNew.length){let t=generateExternalIDTikTokPixel(36),o=getEventID(t),e=getCurrentTimeUTCInSeconds(),r=document.referrer;async function c(){trackEventsAPITikTok($,{utm:tik_tok_utm_parameter?.ttclid?tik_tok_utm_parameter:null,referrer:r,action:"AddToCart",event:"AddToCart",eventShowTool:EVENT_NAME_TOOL.addToCart,event_id:o,url:pageURL,pixel_ids:arrayTikTokPixelCapiTrackNew,shop:Shopify.shop,ip:null!==ip?ip:"",user_agent:user_agent,external_id:t,content_id:""+n,content_type:u,value:otConvertPrice(parseInt(a.total_price)/100),currency:""+currency,ttclid:ot_ttclid,event_time:e,ttp:ttpCookie,ip_source:ipSource,products:i?[i]:null})}c(),1==l&&arrayTikTokPixelCapiTrackNew.forEach(async function(t,e){ttq.checkOmega(""+t,"AddToCart",{content_id:""+n,content_type:u,value:otConvertPrice(parseInt(a.total_price)/100),content_name:""+i.product_title,currency:""+currency},o)})}}else if(void 0!==meta.product){let i=meta.product.id;var t=ot_getUrlParam("variant");if(o==CONTENT_TYPE_IS_PRODUCT&&(i=null!==t?t:meta.product.variants[0].id),arrayTikTokPixelTrackNew?.length||arrayTikTokPixelCapiTrackNew?.length,arrayTikTokPixelTrackNew.forEach(async function(t,e){ttq.checkOmega(""+t,"AddToCart",{content_id:""+i,content_type:u,value:otConvertPrice(parseInt(meta.product.variants[0].price)/100),content_name:""+meta.product.variants[0].name,currency:""+currency})}),0<arrayTikTokPixelCapiTrackNew.length){let e=generateExternalIDTikTokPixel(36),o=getEventID(e),r=getCurrentTimeUTCInSeconds();async function c(){var t=document.referrer;trackEventsAPITikTok($,{utm:tik_tok_utm_parameter?.ttclid?tik_tok_utm_parameter:null,referrer:t,action:"AddToCart",event:"AddToCart",eventShowTool:EVENT_NAME_TOOL.addToCart,event_id:o,pixel_ids:arrayTikTokPixelCapiTrackNew,shop:Shopify.shop,ip:null!==ip?ip:"",user_agent:user_agent,external_id:e,content_id:""+i,content_type:u,value:otConvertPrice(parseInt(meta.product.variants[0].price)/100),currency:""+currency,ttclid:ot_ttclid,event_time:r,ttp:ttpCookie,url:pageURL,ip_source:ipSource,products:meta.product?[meta.product]:null})}c(),1==l&&arrayTikTokPixelCapiTrackNew.forEach(async function(t,e){ttq.checkOmega(""+t,"AddToCart",{content_id:""+i,content_type:u,value:otConvertPrice(parseInt(meta.product.variants[0].price)/100),content_name:""+meta.product.variants[0].name,currency:""+currency},o)})}}t=generateExternalIDTikTokPixel(36);a.attributes.external_id&&a.attributes.external_id==t||otAddExternalIDToOrder($,t)})},500)})}async function omegaCallBackAddToCartTriggerTikTok(t){console.log("ATC auto"),localStorage.removeItem("product_added_to_cart_tik_tok_omega");var i=void 0!==tikTokPixelCheckExpireApp.settings?tikTokPixelCheckExpireApp.settings:null,e=(null!==i?i:tikTokPixelCheckExpireApp).content_type_event,i=(null!==i?i:checkTiktokPixelExpire).enable_deduplication;let n=t?.data?.cartLine,a=(localStorage.setItem("OTPXADDED",1),n?.merchandise?.product),c="product_group",l=a?.id;if(e==CONTENT_TYPE_IS_PRODUCT&&(l=n?.merchandise?.id,c="product"),arrayTikTokPixelTrackNew.forEach(async function(t,e){ttq.checkOmega(""+t,"AddToCart",{content_id:""+l,content_type:c,value:otConvertPrice(parseInt(n?.cost?.totalAmount?.amount)),content_name:""+a?.title,currency:""+n?.cost?.totalAmount?.currencyCode})}),0<arrayTikTokPixelCapiTrackNew.length){let e=generateExternalIDTikTokPixel(36),o=getEventID(e),r=getCurrentTimeUTCInSeconds();(async()=>{var t=document.referrer;trackEventsAPITikTok($,{utm:tik_tok_utm_parameter?.ttclid?tik_tok_utm_parameter:null,referrer:t,action:"AddToCart",event:"AddToCart",eventShowTool:EVENT_NAME_TOOL.addToCart,event_id:o,url:pageURL,pixel_ids:arrayTikTokPixelCapiTrackNew,shop:Shopify.shop,ip:null!==ip?ip:"",user_agent:user_agent,external_id:e,content_id:""+l,content_type:c,value:otConvertPrice(parseInt(n?.cost?.totalAmount?.amount)),currency:""+currency,ttclid:ot_ttclid,event_time:r,ttp:ttpCookie,ip_source:ipSource,products:a?[a]:null})})(),1==i&&arrayTikTokPixelCapiTrackNew.forEach(async function(t,e){ttq.checkOmega(""+t,"AddToCart",{content_id:""+l,content_type:c,value:otConvertPrice(parseInt(n?.cost?.totalAmount?.amount)),content_name:""+a?.title,currency:""+currency},o)})}}async function checkInitiateCheckoutEvent(){$("body").on("click",otElementButtonCheckout,function(t){if(void 0!==itemInCart&&void 0!==itemInCart.items){var i=itemInCart;if(0<i.items.length){let r=[];if($.each(i.items,function(t,e){let o=e.product_id;content_type_event==CONTENT_TYPE_IS_PRODUCT&&(o=e.variant_id),r.push({content_id:""+o,content_type:content_type,content_name:e.product_title,quantity:e.quantity,price:otConvertPrice(e.final_price)})}),arrayTikTokPixelTrackNew.forEach(async function(t,e){ttq.checkOmega(""+t,"StartCheckout",{contents:r,currency:""+currency,value:otConvertPrice(i.total_price/100)})}),0<arrayTikTokPixelCapiTrackNew.length){let t=generateExternalIDTikTokPixel(36),o=getEventID(t),e=getCurrentTimeUTCInSeconds();(async()=>{trackEventsAPITikTok($,{action:"StartCheckout",event:"StartCheckout",eventShowTool:EVENT_NAME_TOOL.startCheckout,event_id:o,pixel_ids:arrayTikTokPixelCapiTrackNew,shop:Shopify.shop,ip:null!==ip?ip:"",user_agent:user_agent,external_id:t,contents:r,currency:""+currency,value:otConvertPrice(i.total_price/100),ttclid:ot_ttclid,event_time:e,ttp:ttpCookie,url:pageURL,ip_source:ipSource})})(),1==enable_deduplication&&arrayTikTokPixelCapiTrackNew.forEach(async function(t,e){ttq.checkOmega(""+t,"StartCheckout",{contents:r,currency:""+currency,value:otConvertPrice(i.total_price/100)},o)})}}}else $.ajax({type:"GET",url:"/cart.js",dataType:"json"}).done(i=>{if(0<i.items.length){let r=[];if($.each(i.items,function(t,e){let o=e.product_id;content_type_event==CONTENT_TYPE_IS_PRODUCT&&(o=e.variant_id),r.push({content_id:""+o,content_type:content_type,content_name:e.product_title,quantity:e.quantity,price:otConvertPrice(e.final_price)})}),arrayTikTokPixelTrackNew.forEach(async function(t,e){ttq.checkOmega(""+t,"StartCheckout",{contents:r,currency:""+currency,value:otConvertPrice(i.total_price/100)})}),0<arrayTikTokPixelCapiTrackNew.length){let t=generateExternalIDTikTokPixel(36),o=getEventID(t),e=getCurrentTimeUTCInSeconds();(async()=>{trackEventsAPITikTok($,{action:"StartCheckout",event:"StartCheckout",eventShowTool:EVENT_NAME_TOOL.startCheckout,event_id:o,pixel_ids:arrayTikTokPixelCapiTrackNew,shop:Shopify.shop,ip:null!==ip?ip:"",user_agent:user_agent,external_id:t,contents:r,currency:""+currency,value:otConvertPrice(i.total_price/100),ttclid:ot_ttclid,event_time:e,ttp:ttpCookie,url:pageURL,ip_source:ipSource})})(),1==enable_deduplication&&arrayTikTokPixelCapiTrackNew.forEach(async function(t,e){ttq.checkOmega(""+t,"StartCheckout",{contents:r,currency:""+currency,value:otConvertPrice(i.total_price/100)},o)})}}var t=generateExternalIDTikTokPixel(36);i.attributes.external_id&&i.attributes.external_id==t||otAddExternalIDToOrder($,t)}).fail(function(t,e){})})}async function otHandleCheckWorkingPageTikTok(){var t=void 0!==tikTokPixelCheckExpireApp.settings?tikTokPixelCheckExpireApp.settings:null,t=!tikTokPixelCheckExpireApp.check_expire&&(null!==t?1==t.enable:1==tikTokPixelCheckExpireApp.enable_app);return void 0!==tikTokPixelCheckExpireApp&&t}((t,r)=>{t.TiktokAnalyticsObject=r;var n=t[r]=t[r]||[];n.methods=["page","track","identify","instances","debug","on","off","once","ready","alias","group","enableCookie","disableCookie"],n.setAndDefer=function(t,e){t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}};for(var e=0;e<n.methods.length;e++)n.setAndDefer(n,n.methods[e]);n.instance=function(t){for(var e=n._i[t]||[],o=0;o<n.methods.length;o++)n.setAndDefer(e,n.methods[o]);return e},n.load=function(t,e){var o="https://analytics.tiktok.com/i18n/pixel/events.js",e=(n._i=n._i||{},n._i[t]=[],n._i[t]._u=o,n._t=n._t||{},n._t[t]=+new Date,n._o=n._o||{},n._o[t]=e||{},document.createElement("script")),o=(e.type="text/javascript",e.async=!0,e.src=o+"?sdkid="+t+"&lib="+r,document.getElementsByTagName("script")[0]);o.parentNode.insertBefore(e,o)},n.checkOmega=function(){var e,o,r,i;if(0<arguments.length&&("string"==typeof arguments[0]&&(e=arguments[0]),"string"==typeof arguments[1]&&(o=arguments[1]),"object"==typeof arguments[2]&&(r=arguments[2]),"string"==typeof arguments[3]?i=arguments[3]:void 0===i&&(i=getEventID(generateExternalIDTikTokPixel(36))),"string"==typeof e&&""!=e.replace(/\s+/gi,"")&&"string"==typeof o&&o.replace(/\s+/gi,"")))switch(n.load(e),n.page(),o){case"StartCheckout":n.instance(e).track("InitiateCheckout",r,{event_id:i});break;case"Purchase":let t=null;try{t=JSON.parse(localStorage.getItem("user_information"))||{}}catch{}n.instance(e).identify({email:t?.email,phone_number:t?.phone_number,external_id:t?.external_id}),n.instance(e).track("CompletePayment",r,{event_id:i});break;case"ViewContent":case"Search":case"AddToCart":case"AddPaymentInfo":case"Lead":case"CompleteRegistration":case"Checkout":case"AddToWishlist":n.instance(e).track(o,r,{event_id:i});break;default:return}}})(window,(document,"ttq")),"undefined"==typeof $?(t=>{t.src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js",t.onload=function(){$=jQuery.noConflict(),void 0===window.otCheckExistFileTikTokPixel&&(Shopify.Checkout||otIncludeTrackTool(),otTikTokPixelInit($),window.otCheckExistFileTikTokPixel=!1)},document.head.appendChild(t)})(document.createElement("script")):void 0===window.otCheckExistFileTikTokPixel&&(Shopify.Checkout||otIncludeTrackTool(),otTikTokPixelInit($),window.otCheckExistFileTikTokPixel=!1),Shopify.formatMoney=function(t,e){"string"==typeof t&&(t=t.replace(".",""));var o="",r=/\{\{\s*(\w+)\s*\}\}/,e=e||this.money_format;function i(t,e){return void 0===t?e:t}function n(t,e,o,r){return e=i(e,2),o=i(o,","),r=i(r,"."),isNaN(t)||null==t?0:(e=(t=(t/100).toFixed(e)).split("."))[0].replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1"+o)+(e[1]?r+e[1]:"")}switch(e.match(r)[1]){case"amount":o=n(t,2);break;case"amount_no_decimals":o=n(t,0);break;case"amount_with_comma_separator":o=n(t,2,".",",");break;case"amount_no_decimals_with_comma_separator":o=n(t,0,".",",")}return e.replace(r,o)};var debounceTimeout=null,triggerTypeCheckEvent=!1,countEventAtc=0;async function updateAddToCartLogicTikTok(){setTimeout(()=>{new MutationObserver(function(t){t.forEach(async function(t){debounceTimeout||(debounceTimeout=1,setTimeout(async()=>{"new"==checkStoreNewOmegaTikTok&&($(otElementButtonAddToCart).off("click"),null!=localStorage.getItem("product_added_to_cart_tik_tok_omega")?($(otElementButtonAddToCart).off("click"),otHandleCheckWorkingPageTikTok()&&1!=countEventAtc&&await omegaCallBackAddToCartTriggerTikTok(JSON.parse(localStorage.getItem("product_added_to_cart_tik_tok_omega"))?.dataEvent),localStorage.removeItem("product_added_to_cart_tik_tok_omega"),triggerTypeCheckEvent=!0,countEventAtc=0,console.log("new code")):(!triggerTypeCheckEvent&&otHandleCheckWorkingPageTikTok()&&checkAddToCartEventTikTok(),triggerTypeCheckEvent=!0)),debounceTimeout=null},1e3))})}).observe(document.documentElement,{attributes:!0,characterData:!0,childList:!0,subtree:!0,attributeOldValue:!0,characterDataOldValue:!0})},500)}function addDataLocalStorageTriggerTikTok(){localStorage.setItem("user_agent",getUserAgent()),localStorage.setItem("currency",Shopify.currency.active),localStorage.setItem("arrayTikTokPixelCapiTrackNew",JSON.stringify(arrayTikTokPixelCapiTrackNew)),localStorage.setItem("arrayTikTokPixelTrackNew",JSON.stringify(arrayTikTokPixelTrackNew)),localStorage.setItem("shop",Shopify.shop),localStorage.setItem("ttclid",JSON.stringify(otAddAttributeIDAds())),localStorage.setItem("external_id",generateExternalIDTikTokPixel(36)),localStorage.setItem("enable_deduplication",null!==tikTokPixelCheckExpireApp.settings?tikTokPixelCheckExpireApp.settings.enable_deduplication:0)}function OtDetectAdsUrlTikTokPixel(){let e=!1;return["ttclid","utm_source","utm_campaign","ad_group","ad","campaign_id","ad_group_id","ad_id"].every(t=>!window.location.search.includes(t)||!(e=!0)),e}function otSetCookieByAttributeWindowTikTokPixel(t,e){var o=new Date,r=otDetectAttributeWindowTikTokPixel(),r=(o.setTime(o.getTime()+24*r*60*60*1e3),"expires="+o.toGMTString());document.cookie=t+"="+e+";"+r+";path=/"}function otDetectAttributeWindowTikTokPixel(){var t;return"undefined"!=typeof tikTokPixelCheckExpireApp&&tikTokPixelCheckExpireApp.settings?(t=parseInt(tikTokPixelCheckExpireApp.settings.click_attribution_window,10)||7,Math.max(1,t)):14}function otDetectUTMUrlTikTokPixel(){return{ttclid:otDetectFieldTikTokPixel("ttclid"),utm_source:otDetectFieldTikTokPixel("utm_source"),utm_campaign:otDetectFieldTikTokPixel("utm_campaign"),ad_group:otDetectFieldTikTokPixel("ad_group")||otDetectFieldTikTokPixel("utm_terms"),ad:otDetectFieldTikTokPixel("ad")||otDetectFieldTikTokPixel("utm_contents"),campaign_id:otDetectFieldTikTokPixel("campaign_id"),ad_group_id:otDetectFieldTikTokPixel("ad_group_id"),ad_id:otDetectFieldTikTokPixel("ad_id")}}function otGetCookieTikTokPixel(t){var o=t+"=",r=(document.cookie,document.cookie.split(";"));for(let e=0;e<r.length;e++){let t=r[e];for(;" "==t.charAt(0);)t=t.substring(1);if(0==t.indexOf(o))return t.substring(o.length,t.length)}return""}function otDetectUTMCookieTikTokPixel(){return{ttclid:otGetCookieTikTokPixel("ot_tik_tok_ttclid"),utm_source:otGetCookieTikTokPixel("ot_tik_tok_utm_source"),utm_campaign:otGetCookieTikTokPixel("ot_tik_tok_utm_campaign"),ad_group:otGetCookieTikTokPixel("ot_tik_tok_ad_group")||otGetCookieTikTokPixel("ot_tik_tok_utm_terms"),ad:otGetCookieTikTokPixel("ot_tik_tok_ad")||otGetCookieTikTokPixel("ot_tik_tok_utm_contents"),campaign_id:otGetCookieTikTokPixel("ot_tik_tok_campaign_id"),ad_group_id:otGetCookieTikTokPixel("ot_tik_tok_ad_group_id"),ad_id:otGetCookieTikTokPixel("ot_tik_tok_ad_id")}}function otDetectFieldTikTokPixel(t){var e=ot_getUrlParam(t);return null!=e?(otSetCookieByAttributeWindowTikTokPixel("ot_tik_tok_"+t,e),e):(otSetCookieByAttributeWindowTikTokPixel("ot_tik_tok_"+t,""),"")}function otTikTokPixelDetectCampaign(){return(OtDetectAdsUrlTikTokPixel()?otDetectUTMUrlTikTokPixel:otDetectUTMCookieTikTokPixel)()}