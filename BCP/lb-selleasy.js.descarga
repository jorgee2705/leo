(()=>{var __webpack_modules__={650:e=>{e.exports={HOST_NAME:"https://upsell-app.logbase.io",IS_LOGS_REQUIRED:"false",API_VERSION:"2024-10"}},343:(e,t,i)=>{const r=i(650),o=i(827),n={handleDiscount:async(e,t,i,s,c=!1)=>new Promise((async(a,d)=>{if("none"===s.method||!i?.length)return void a(void 0);let l,u={trigger:{id:t?.lbCart&&t?.id,productId:t?.product_id||t?.id,check:!(s.configs?.ignoreTrigger||c)},products:i.map((e=>({id:e.id,productId:e.productId,price:e.price})))};if(["widget#bl","widget#ba"].includes(e.widget)){let t="auto"===e.offerItems?.type?e.offerItems?.count:e.offerItems?.values?.length;if(t=Math.min(t,e.offerItems?.configs?.maxItems||t)+1,!(t===i.length||(i?.find((e=>e.isTrigger))||s.configs?.ignoreTrigger)&&("function"===s.method&&"product"===s.class?Object.keys(s.tiers||{}).some((e=>Number(e)<=i.length)):(s.configs?.minProducts||t)<=i.length)))return void a(void 0)}if(["function","custom"].includes(s?.method))l={discount:{code:e.discounts.code,...u},offer:e.recordType};else if("dynamic"===s?.method){let t=`${r.HOST_NAME}/processOffer`,n={myShopifyDomain:e.myShopifyDomain,widgetType:e.widget,recordType:e.recordType,triggerProduct:u.trigger?.id,products:i.map((e=>({id:e.id,productId:e.productId,price:e.price})))};l={discount:{...await o.apiRequest(t,"POST",n),...u},offer:e.recordType}}l&&n.stackCode(l),a(l)})),stackCode:async e=>{let t=localStorage.getItem("lb-offer-codes");if(t){t=JSON.parse(t);let i=(t||[]).findIndex((t=>t?.offer===e.offer));-1!==i&&(n.deleteCodes([t[i].discount.id]),t.splice(i,1)),t.push(e)}localStorage.setItem("lb-offer-codes",JSON.stringify(t||[e]))},getCode:e=>{let t=localStorage.getItem("lb-offer-codes");return t&&(t=JSON.parse(t)),t?.find((t=>t?.offer===e.recordType))},deleteCodes:e=>{e.length&&o.apiRequest(`${r.HOST_NAME}/processOffer`,"POST",{codes:e,type:"delete"})},validateCodes:(e,t=!1)=>{let i=localStorage.getItem("lb-offer-codes");if(i){i=JSON.parse(i);let r=[];return i?.length&&!t&&(i=i.filter((t=>{let i=t?.discount?.trigger;return!(!t?.discount?.products?.every((t=>e.items.some((e=>e.id===t.id))))||i&&i?.check&&!e.items.find((e=>i?.id?e.id===i?.id:e.product_id===i?.productId)))||(t?.discount?.id&&r.push(t?.discount?.id),!1)}))),n.deleteCodes(r),i?.length?i:[]}return[]},mutateDiscount:async(e,t,i=!1)=>{if(!e)return Promise.resolve();let s=t||await o.cart(!0),c=n.validateCodes(s,i);if(c?.length&&s?.token){localStorage.setItem("lb-offer-codes",JSON.stringify(c)),c=c.slice(-5).map((e=>e?.discount?.code)).filter(Boolean);let t=`gid://shopify/Cart/${s.token}`;if("function"==typeof window.lbDealeasy?.applyDiscountsToCart)return window.lbDealeasy.applyDiscountsToCart(c,"selleasy",t);let i="\n            mutation cartDiscountCodesUpdate($id: ID!, $discountCodes:[String!]) {\n              cartDiscountCodesUpdate(cartId: $id, discountCodes: $discountCodes) {\n                cart { id }\n                userErrors { field message }\n              }\n            }",n={discountCodes:c,id:t},a=`https://${window.location.hostname}/api/${r.API_VERSION}/graphql.json`;return o.apiRequest(a,"POST",{query:i,variables:n},{"X-Shopify-Storefront-Access-Token":e,"Access-Control-Allow-Origin":"*"})}return localStorage.removeItem("lb-offer-codes"),Promise.resolve()}};e.exports=n},307:(e,t,i)=>{const r=i(650),o=i(827);e.exports={trackMetric:(e,t,i=void 0,n)=>{let s="offer-clicked"===e?localStorage:sessionStorage,c=s.getItem(`lb-${e}`);c=c?JSON.parse(c):{offers:{}};const a=!!c.offers[t.recordType];c.offers[t.recordType]={metricId:t.offerMetricId,timestamp:(new Date).getTime(),variantIds:i?.map((e=>e.id))||[]};let d={offers:c.offers,shop:n.myShopifyDomain,presentmentCurrency:{shopifyCurrency:window.Shopify?.currency,shopCurrencyCode:n.shopCurrencyCode}};s.setItem(`lb-${e}`,JSON.stringify(d)),!a&&o.apiRequest(`${r.HOST_NAME}/v2/metrics`,"POST",{type:e,offer:{metricId:t.offerMetricId},shop:n.myShopifyDomain})}}},410:(e,t,i)=>{const r=i(827),o=i(326);let n,s;const c={isOfferValid:async(e,t)=>{if("all"===e?.triggers?.type)return!0;let i=JSON.parse(JSON.stringify(e?.triggers?.values||[]));if(["product","variant"].includes(e?.triggers?.type))return i.some((i=>(i.handle===t.handle||i.id.includes(t.product_id||t.id))&&("variant"!==e?.triggers?.type||i?.variants?.some((e=>e.id.includes(t.variant_id))))));if("tags"===e?.triggers?.type)return i.some((e=>t?.tags?.includes(e?.handle)));if("collection"===e?.triggers?.type){const e=await r.getProductCollections(t.product_id||t.id,n.storeFrontAccessToken)||[];return i.some((t=>e.includes(t.handle)))}return!1},actionOffers:async function(e){let t,i,s=await r.cart(),a=(s?.items||[]).sort(((e,t)=>e.line_price-t.line_price));for(let o of a||[])for(let n of e){const e="tags"===n?.triggers?.type?await r.getProduct(o.handle):o;"widget#icuc"===n.widget?(!i||i.priority<n.priority)&&await c.isOfferValid(n,e)&&(n.triggerItem={...{...e,lbCart:!0},isTrigger:!0},i=n):(!t||t.priority<n.priority)&&await c.isOfferValid(n,e)&&(n.triggerItem={...{...e,lbCart:!0},isTrigger:!0},t=n)}i&&o.handleWidgets([i],r.checkPage(!0)?void 0:{isDrawer:!0},n),o.addActionOffer([t])},getOffers:async function(e,t,i){let r=[],a={};n=e,s=t;for(let s of n.widgets){let n=e.offers.filter((e=>(i||[s.recordType]).includes(e.widget)))?.sort(((e,t)=>t.createdAt-e.createdAt));for(let i of n){if(!i.isEnabled)continue;let n=["widget#ccpa","widget#ccpf","widget#icuc"].includes(s.recordType)&&"checkout";if(n)"widget#icuc"===s.recordType?o.registerMutationObserver(void 0,"icuc"):o.registerListeners(n,e),r.push(i);else if(t){const e=a[s.recordType];(!e||e.priority<i.priority)&&await c.isOfferValid(i,t)&&(a[s.recordType]={...i,triggerItem:{...t,isTrigger:!0}})}}}let d=["widget#atcp","widget#atcf"].map((e=>a[e])).filter((e=>e));o.addActionOffer(d.length>1?[d.reduce(((e,t)=>e.priority>t.priority?e:t))]:d,n),["widget#atcp","widget#atcf"].forEach((e=>delete a[e])),c.actionOffers(r);let l=Object.values(a).filter((e=>e));return l.length&&o.handleWidgets(l,void 0,e),l}};e.exports=c},879:(e,t,i)=>{const r=i(650),o=i(827);let n=e.exports={cache:function(e,t){if("set"===e)localStorage.setItem("lb-upsell-setup",JSON.stringify(t)),localStorage.setItem("lb-upsell-setupFetchedAt",(new Date).getTime());else if("clear"===e)localStorage.removeItem("lb-upsell-setup"),localStorage.removeItem("lb-upsell-setupFetchedAt");else if("get"===e){let e=localStorage.getItem("lb-upsell-setup"),t=localStorage.getItem("lb-upsell-setupFetchedAt");return e&&t&&Number(t)>(new Date).getTime()-72e5?JSON.parse(e):void 0}},fetchObject:function(e,t,i=[],s=void 0){return new Promise(((c,a)=>{let d={cursor:s||null},l=`https://${window.location.hostname}/api/${r.API_VERSION}/graphql.json`;o.apiRequest(l,"POST",{query:t.queryString,variables:d},{"X-Shopify-Storefront-Access-Token":e,"Access-Control-Allow-Origin":"*"}).then((r=>{let o=r?.data?.metaobjects;if(o?.nodes?.length){!t.paginate&&c(o.nodes);let r=[...i,...o.nodes];o.pageInfo?.hasNextPage?n.fetchObject(e,t,r,o.pageInfo.endCursor).then((e=>{r=[...r,...e],c(r)})).catch((e=>{a(!1)})):c(r)}else a(!1)})).catch((e=>{a(!1)}))}))},isCached:e=>!(e.createdAt>=(new Date).valueOf()-6048e5)&&(!e.lastAdminActiveAt||e.lastAdminActiveAt<(new Date).valueOf()-72e5),getSFSetup:async function(e,t=!1){return new Promise(((i,r)=>{let o=[{queryString:'{\n            metaobjects(type: "$app:selleasy-setup", first: 1, sortKey: "updated_at") {\n              nodes {\n                field(key: "selleasy-setup") {\n                  value\n                  key\n                }\n                id\n                handle\n              }\n            }\n          }',paginate:!1}];t||["offer","widget"].forEach((e=>{o.push({queryString:`query getMetaObjects($cursor: String) {\n                metaobjects(type: "$app:selleasy-${e}", first: 250, after: $cursor, sortKey: "updated_at") {\n                  nodes {\n                    field(key: "selleasy-${e}") {\n                      value\n                      key\n                    }\n                    id\n                    handle\n                  }\n                  pageInfo {\n                    hasNextPage\n                    endCursor\n                  }\n                }\n              }`,paginate:!0})}));let s=o.map((t=>n.fetchObject(e,t)));Promise.all(s).then((e=>{if(e?.length){let r=e[0]?.length&&e[0][0]?.field?.value?.length&&JSON.parse(e[0][0]?.field?.value),o=e[1]?.length&&e[1].map((e=>e?.field?.value?.length&&JSON.parse(e.field.value))),s=e[2]?.length&&e[2].map((e=>e?.field?.value?.length&&JSON.parse(e.field.value)));o=(o||[]).filter((e=>!["widget#tup","widget#cupl"].includes(e?.widget)));let c={...r,offers:o,widgets:s};n.cache(n.isCached(c)?t?"":"set":"clear",c),i(c)}else i(!1)})).catch((e=>{i(!1)}))}))},fetchSetup:async function(e){let t=`${r.HOST_NAME}/setup?myShopifyDomain=${e}`;return o.apiRequest(t,"GET",null).then((e=>(n.cache(e.isSetupCachedInClientSide?"set":"clear",e),e))).catch((e=>!1))},validateSetup:async function(e){let t;if(window?.lbupsellToken&&(t=await n.getSFSetup(window.lbupsellToken,!0),t))return t;let i=`${r.HOST_NAME}/setupValidate?myShopifyDomain=${e}`;o.apiRequest(i,"GET",null).then((e=>{!e.isSetupCachedInClientSide&&n.cache("clear")}))},getSetup:async function(e){return new Promise((async(t,i)=>{let r=n.cache("get");r?n.validateSetup(e):r=await(window?.lbupsellToken?n.getSFSetup(window.lbupsellToken):n.fetchSetup(e)),t(r)}))}}},827:(e,t,i)=>{const r=i(650);let o,n=window.location.origin+(window.Shopify?.routes?.root||"/");const s={getLocale:function(){let e=Shopify?.locale,t=Shopify?.country;return e&&(e=e.toLocaleUpperCase(),e=["PT-","ZH-"].some((t=>e.startsWith(t)))?e.replace("-","_"):e.split("-")[0]),{lang:e,country:t}},checkPage:function(e){return window.location.pathname.indexOf(e?"/cart":"/products/")>-1},apiRequest:function(e,t,i,r={}){return new Promise(((o,n)=>{let s=new XMLHttpRequest;s.open(t,e,!0),r["Content-Type"]="application/json; charset=UTF-8",r["Access-Control-Allow-Origin"]="*",Object.keys(r).forEach((e=>{s.setRequestHeader(e,r[e])})),s.send(JSON.stringify({...i,myShopifyDomain:window.lbShopDomain})),s.onload=()=>{if(200===s.status)try{o(JSON.parse(s.responseText))}catch(e){o(void 0)}else o(void 0)},s.onerror=()=>{o(void 0)}}))},getHandle:function(e){return e.split("/").filter((e=>e)).pop()},getProduct:async function(e,t){t?.handleMultiLangProductHandle&&(e=await s.getGraphQLProduct(e,t?.storeFrontAccessToken)||e);let i=n+"products/"+e+".js";return await s.apiRequest(i,"GET",null).then((e=>e)).catch((e=>{}))},getGraphQLProduct:async function(e,t){return new Promise(((i,o)=>{let{lang:c,country:a}=s.getLocale();if(c){let o=`query productDetails @inContext(country: ${a}, language: ${c}) {\n                productByHandle(handle: "${e}") {\n                  handle\n                }\n              }`,d=n+`api/${r.API_VERSION}/graphql.json`;s.apiRequest(d,"POST",{query:o},{"X-Shopify-Storefront-Access-Token":t}).then((t=>{i(t?.data?.productByHandle?.handle||e)}))}else i(e)}))},getProductCollections:async function(e,t){let i=n+`api/${r.API_VERSION}/graphql.json`,o=`{\n            product(id: "gid://shopify/Product/${e}") {\n              id\n              collections(first: 250) {\n                nodes {\n                  handle\n                }\n              }\n            }\n          }`;return s.apiRequest(i,"POST",{query:o},{"X-Shopify-Storefront-Access-Token":t}).then((e=>e?.data?.product?.collections?.nodes?.map((e=>e.handle))))},getOfferedProductsAuto:async function(e,t,i){let r=n+`recommendations/products.json?product_id=${e}&limit=${t}`+(i?`&intent=${i}`:"");return await s.apiRequest(r,"GET",null).then((e=>e?.products||[])).catch((e=>{}))},getOfferedProducts:function(e,t){return"auto"===e.offerItems?.type?[s.getOfferedProductsAuto(e.triggerItem?.product_id||e.triggerItem?.id,e.offerItems?.count||2,e.offerItems?.intent)]:(["icuc","ccp"].some((t=>e.widget.split("#")[1].startsWith(t)))||(e.offerItems.values=e.offerItems?.values?.filter((t=>!t.id.includes(e.triggerItem?.id)))),e.offerItems?.values?.map((async e=>s.getProduct(e.handle,t))))},cart:async function(e=!1,t=!1){return(e||!o)&&await s.apiRequest("/cart.js","GET",null).then((i=>{i&&(o=i,e&&window.dispatchEvent(new CustomEvent("lbSECartUpdated",{detail:{cart:i,isSelleasy:t}})))})),o},registerCartListener:function(){const e=["/cart/add","/cart/change","/cart/update","/cart/clear"],t=window.XMLHttpRequest.prototype.open;window.XMLHttpRequest.prototype.open=function(){return this.addEventListener("load",(function(){this._url&&e.some((e=>this._url.includes(e)))&&s.cart(!0,this._url.includes("selleasy"))})),t.apply(this,arguments)};const{fetch:i}=window;window.fetch=async(...t)=>{let[r,o]=t,n=await i(r,o);try{"string"==typeof r&&e.some((e=>r.includes(e)))&&s.cart(!0,r.includes("selleasy"))}catch(e){}return n}}};e.exports=s},326:(e,t,i)=>{const r=i(307),o=i(827),n=i(343),s=(i(410),i(343));let c,a,d,l=[],u=[],f=[],p=!1,g=[],w={},m=!1,y=!1;const h=e.exports={type:(e,t)=>{switch(t){case"popup":return["widget#atcp","widget#atcf","widget#ccpa","widget#ccpf"].includes(e);case"trigger":return["widget#pal","widget#pac","widget#pag"].includes(e);case"stc":return["widget#cpal","widget#cpac","widget#cpag","widget#icuc"].includes(e)}},addActionOffer:(e=[],t)=>{l=[...l,...e.filter((e=>e))],c=c||t,l.some((e=>e.widget.includes("atc")))&&h.registerListeners("atc")},triggerOffer:e=>{d||(d=e);let t=[];g?.length?(g.forEach((e=>{h.type(e?.type,"trigger")&&t.push(e)})),t?.length?h.processWidgets(t):h.reset()):h.reset()},actionOffer:(e,t)=>{p=!0;let i=l.find((e=>t?e.widget.includes("atc"):["widget#ccpa","widget#ccpf"].includes(e.widget)));if(i){let t=c.widgets.find((e=>e.recordType===i.widget)),r=t?.configs?.TACSelector?.isEnabled&&document.querySelector(t?.configs?.TACSelector?.selector);d=e,!r||r?.checked?h.handleWidgets([i]):h.reset()}else h.triggerOffer(e)},registerMutationObserver:(e,t)=>{w[t]||(w[t]=!0,new MutationObserver((i=>{i?.length&&i.forEach((({addedNodes:i})=>{i?.length&&i.forEach((i=>{if(!i?.querySelectorAll)return;(i.querySelectorAll(e).length||i.matches(e))&&h.registerListeners(t);let r=u.filter((e=>"widget#icuc"===e.widget));if(r?.length){let e=c.widgets.find((e=>"widget#icuc"===e.recordType));e?.position?.drawer?.isEnabled&&(()=>{let t=window.innerWidth<768?"mobile":"desktop",o=e?.position?.drawer?.[t]?.selector;if(i.querySelectorAll(o)?.length||i.matches(o)){let e=r.filter((e=>!document.querySelector(`lb-upsell-widget[offer="${e.recordType.split("-")[0]}"]`)));e?.length&&h.handleWidgets(e,{isDrawer:!0})}})()}}))}))})).observe(document.body,{childList:!0,subtree:!0}))},getListners:()=>({checkout:c?.commonConfig?.checkoutSelector||"button[name='checkout'], input[name='checkout'], a[href='/checkout']",atc:c?.commonConfig?.atcSelector||"button[name='add'], input[name='add']"}),registerActionListeners:(e,t)=>{h.registerMutationObserver(e,t);let i=document.querySelectorAll(e);i?.length&&i.forEach((e=>{"true"!==e.getAttribute(`lb-${t}-listner`)&&(e.setAttribute(`lb-${t}-listner`,!0),e.addEventListener("click",(e=>{if("checkout"===t&&f.some((e=>["widget#ccpa","widget#ccpf"].includes(e.widget))))return;if(p)return void(p=!1);e.preventDefault(),e.stopImmediatePropagation(),e.stopPropagation();let i=e.target?.parentNode?.closest(`[lb-${t}-listner]`);h.actionOffer(i||e.target,"atc"===t)}),{capture:!0}))}))},remove:e=>{let t=document.querySelectorAll(`lb-upsell-widget[widget="${e}"]`);t?.length&&t.forEach((e=>e.remove()))},reset:e=>{h.type(e,"popup")?h.triggerOffer(d):d&&(d?.click(),d=void 0)},registerListeners:(e,t=void 0)=>{switch(c=t||c,e){case"checkout":case"atc":h.registerActionListeners(h.getListners()[e],e);break;case"event":window.addEventListener("lbPreviewProduct",(e=>{if(e.detail?.product)if(e.detail.action&&"preview"!==e.detail.action)["open","newTab"].includes(e.detail.action)&&window.open(`https://${window.location.hostname}${window?.Shopify?.routes?.root||"/"}products/${e.detail.product.handle}`,"newTab"===e.detail.action?"_blank":"_self");else{document?.body?.insertAdjacentHTML("beforeend",'<lb-upsell-widget widget="widget#preview"></lb-upsell-widget>');let t=document.querySelector('lb-upsell-widget[widget="widget#preview"]'),i=c.widgets.find((e=>"widget#preview"===e.recordType)),r=window.Shopify?.locale;t&&(t.lbPayload={widget:{offers:[e.detail.product],contents:{actionText:(i?.translations?.[r]||i?.contents)?.actionText||"View more details",currency:{symbol:c.shopEmailCurrencyFormat,format:c.commonConfig?.currencyFormat||c.shopMoneyInEmailsFormat,rate:c.shopCurrencyCode!==Shopify?.currency?.active?Shopify?.currency:void 0}},configs:{...i?.configs,...c?.commonConfig},diy:i?.diy,type:"widget#preview"}})}})),window.addEventListener("lbSECartUpdated",(e=>{if(a=e.detail.cart,!e.detail?.isSelleasy&&(f=[]),e.detail?.cart?.items?.length){l=l.filter((e=>e?.widget.includes("atc")));let t=document.querySelector('lb-upsell-widget[widget="widget#icuc"]');t&&!e.detail.cart.items.some((e=>e.id===t.lbPayload?.widget?.triggers?.[0].id))&&h.remove("widget#icuc"),!d&&c?.offers?.length&&window.lbOfferHandler(c,void 0,["widget#icuc","widget#ccpa","widget#ccpf"]),!d&&!e.detail.isSelleasy&&n.mutateDiscount(window.lbupsellToken,e.detail.cart)}else h.remove("widget#icuc")})),window.addEventListener("lbWidgetCta",(e=>{let t=e.detail.type.includes("atc");e.detail?.action?.isDismissed&&!t?p=!1:"end"===e.detail?.action?.key&&e.detail?.action?.value?(document.body.classList.remove("lb-popup-prevent-scroll"),y=!0,!m&&(y=!1,t?h.triggerOffer():h.reset())):(m=!0,h.processWidgets([{widgetSrcElement:e.detail.widgetSrcElement}],e.detail.action?.product,t))})),window.addEventListener("lbWidgetRendered",(e=>{h.type(e.detail.type,"trigger")&&h.registerListeners("atc");let t=e.detail.widgetSrcElement?.getAttribute("offer");if(!g.some((e=>e.offer===t))&&g.push({...e.detail,offer:t}),t){let e=u.find((e=>e.recordType.startsWith(t)));!f.some((e=>e.recordType.startsWith(t)))&&f.push(e),e&&r.trackMetric("offer-viewed",e,void 0,c)}}))}},processWidgets:(e,t,i=!1)=>{let r=e.map((e=>h.processV2Products(e.widgetSrcElement,t,i)));return Promise.all(r).then((async e=>{let t=e.reduce(((e,t)=>(t.items&&e.push(...t.items),e)),[]);t.length&&await o.apiRequest(`https://${window.location.hostname}${window.Shopify?.routes?.root||"/"}/cart/add.js?src=selleasy`,"POST",{items:t}),h.afterActions(e)}))},afterActions:async e=>{await Promise.all(e.map((e=>e.callback?.()))),e.reduce(((e,t)=>(t.afterAction&&!e.some((e=>e===t.afterAction))&&e.push(t.afterAction),e)),[]).forEach((e=>{e&&"stay"!==e?"refresh"===e?location?.reload():window.location.href="/cart"+("checkout"===e?"/checkout":""):window.lbSelleasyUtils?.drawerRefresh()}))},processV2Products:async(e,t=void 0,i=!1)=>new Promise(((o,d)=>{(t?Promise.resolve([t]):e?.getSelectedProducts()).then((async d=>{if(d?.length){let t=e?.getAttribute("offer"),l=u.find((e=>e.recordType.startsWith(t))),f=l.triggerItem?.product_id||l.triggerItem?.id,p={items:d.map((i=>({id:i.id,quantity:(i.quantity||1)*(e.lbPayload?.lb_config?.quantity||1),properties:{"_lb-product":f+"#"+t}})))},g=c.widgets.find((e=>e.recordType===l.widget)),w=!g?.configs?.TACSelector?.isEnabled||document.querySelector(g?.configs?.TACSelector?.selector)?.checked;if(t&&l&&g&&w){["widget#atcf","widget#ccpf"].includes(l.widget)&&(d=[...(e.lbPayload?.funnelItems||[]).map((e=>e.lb_config)),...d]),h.type(l.widget,"stc")&&(d=[...d,...s.getCode(l)?.discount?.products||[]]);let t=l.discounts?.method?n.handleDiscount(l,l.triggerItem,d,l.discounts,h.type(l.widget,"stc")):Promise.resolve(),u=await t;u&&await n.mutateDiscount(c.storeFrontAccessToken,a,!0),o({items:p.items,callback:async()=>{r.trackMetric("offer-clicked",l,d,c),e.updateWidgetState({isLoading:!1}),u&&await n.mutateDiscount(c.storeFrontAccessToken,void 0,!0),m=!1,h.type(l.widget,"popup")?y&&(y=!1,i?h.triggerOffer():h.reset()):h.reset()},afterAction:g?.configs?.[e.lbPayload?.widget?.overrides?.isDrawer?"drawerAfterAction":"afterAction"]})}else o({callback:()=>{h.reset()}})}else e.updateWidgetState({isLoading:!1,product:t}),o({callback:()=>{h.reset()}})})).catch((e=>{o({callback:()=>{h.reset()}})}))})),getPosition:(e,t)=>{const i=window.innerWidth<768;if(t?.isCustom)return{selector:`.lb-ctm-block[offerId="${t.recordType.split("-")[0]}"]`,insertPosition:"afterbegin"};if(h.type(e.recordType,"popup"))return{selector:"body",insertPosition:"beforeend"};if("widget#icuc"===e.recordType&&!o.checkPage(!0))return e.position?.drawer?.isEnabled?e.position?.drawer?.[i?"mobile":"desktop"]:void 0;if("custom"===e?.position?.type){let t=e.position[i?"mobile":"desktop"];if(document.querySelector(t.selector))return t}return{selector:`.lb-widget-${e.recordType.split("#")[1]}`,insertPosition:"afterbegin"}},formatWidgetContents:(e,t)=>{let i=e?.contents||{},r=t?.contents||{},o={...i,...r},n=window.Shopify?.locale;return c.shopLocales.find((e=>e.primary))?.locale!==n&&(o={...e?.translations?.[n]||i,...t?.translations?.[n]||r}),o},handleWidgets:(e,t,i)=>{try{c=c||i,u=u.filter((t=>!e.some((e=>e.recordType.startsWith(t.recordType))))).concat(e),e=e.sort(((e,t)=>(t.priority||0)-(e.priority||0)));for(let i of e){let e=["widget#ba","widget#bl"].includes(i.widget),r=c.widgets.find((e=>e.recordType===i.widget));if(r&&!r.isDisabled&&i.isEnabled){let n=h.getPosition(r,i);if(!n)continue;let s=i.recordType.split("-")[0];h.remove(r.recordType);let a=document.querySelector(n.selector);if(a){a.insertAdjacentHTML(n.insertPosition,`<lb-upsell-widget widget="${i.widget}" offer="${s}"></lb-upsell-widget>`);let d=o.getOfferedProducts(i,c);Promise.all(d).then((async n=>{let a=window.Shopify?.locale;if((e||h.type(i.widget,"trigger"))&&(i.triggerItem.variants=i.triggerItem.variants.filter((e=>e.available)),!i.triggerItem.available||!i.triggerItem.variants.length))return;"auto"===i.offerItems?.type&&(n=n[0]);let d=await o.cart(),l=["widget#ccpf","widget#atcf"].includes(i.widget);if(n=n.map((e=>{if(!e||!e?.available)return!1;if(e.variants=e.variants.filter((e=>e.available)),"variant"===i.offerItems.type){let t=i.offerItems?.values?.find((t=>t.id.includes(e.id)));e.variants=e.variants.filter((e=>(t.variants||[]).some((t=>t.id.includes(e.id)))))}if(l){let t=i.offerItems?.values?.find((t=>t.id.includes(e.id)));e.funnelId=t?.funnelId,e.contents={...t?.contents,...t?.translations?.[a]||{}}}return e.variants.length>0&&(!i.offerItems?.configs?.ignoreAlreadyBought||!d?.items?.some((t=>t.product_id===e.id)))&&e})).filter((e=>e)),l&&!n.find((e=>!e.funnelId)))return;i.offerItems?.configs?.isSortedRandomly&&(n=n.sort((()=>Math.random()-.5))),i.offerItems?.configs?.maxItems&&(n=n.slice(0,i.offerItems?.configs?.maxItems));let u=document.querySelector(`lb-upsell-widget[offer="${s}"]`),f={...r?.translations?.[a]||r?.contents,...i?.translations?.[a]||i?.contents};u&&n?.length?(e&&(n=[i.triggerItem,...n]),u.lbPayload={widget:{triggers:[i.triggerItem],offers:n,offerCount:"auto"===i.offerItems?.type?i.offerItems?.count:i.offerItems?.values?.length,contents:{...f,currency:{symbol:c.shopEmailCurrencyFormat||c.shopCurrencyCode,format:c.commonConfig?.currencyFormat||c.shopMoneyInEmailsFormat,rate:c.shopCurrencyCode!==Shopify?.currency?.active?Shopify?.currency:void 0}},type:i.widget,discounts:"none"===i.discounts?.method||i.discounts?.isDisabled?void 0:{...i.discounts,text:f?.discountText||i.discounts?.text,tierLabel:f?.tierLabel||i.discounts?.tierLabel},diy:r?.diy,configs:{...i.offerItems?.configs,...r?.configs,...c?.commonConfig},overrides:t}},r.customCSS?.length&&u.insertAdjacentHTML("afterbegin",`<style>${r.customCSS}</style>`)):(u?.remove(),h.reset(i.widget))})).catch((e=>{h.reset(i.widget)}))}else h.reset(i.widget)}else h.reset(i.widget)}}catch(e){h.reset()}}}}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var i=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](i,i.exports,__webpack_require__),i.exports}const setupHandler=__webpack_require__(879),offerHandler=__webpack_require__(410),utils=__webpack_require__(827),widgetHandler=__webpack_require__(326),discountHandler=__webpack_require__(343);(function(window){window.lbShopDomain=window.Shopify.shop,window.lbShopDomain&&window.lbupsellVersion&&(utils.registerCartListener(),utils.cart(!0),widgetHandler.registerListeners("event"),setupHandler.getSetup(window.lbShopDomain).then((async setup=>{if(setup.isEnabled&&eval(setup.customJs),setup.customCSS){const e=document.createElement("style");e.textContent=setup.customCSS,document.head.appendChild(e)}if(discountHandler.mutateDiscount(setup.storeFrontAccessToken),setup.offers?.length){let e=utils.getHandle(window.location.pathname),t=utils.checkPage()?await utils.getProduct(e,setup):void 0;window.lbOfferHandler=offerHandler.getOffers,window.lbHandlers={triggers:widgetHandler.triggerOffer,action:widgetHandler.actionOffer},await window.lbOfferHandler(setup,t)}})))})(window)})();